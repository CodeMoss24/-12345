<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>极简待办 - Todo List</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* 自定义滚动条 */
        .custom-scrollbar::-webkit-scrollbar {
            width: 6px;
        }
        .custom-scrollbar::-webkit-scrollbar-track {
            background: #f1f1f1;
        }
        .custom-scrollbar::-webkit-scrollbar-thumb {
            background: #d1d5db;
            border-radius: 3px;
        }
        .custom-scrollbar::-webkit-scrollbar-thumb:hover {
            background: #9ca3af;
        }

        /* 动画效果 */
        .fade-in {
            animation: fadeIn 0.3s ease-in forwards;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .slide-out {
            animation: slideOut 0.3s ease-out forwards;
        }
        @keyframes slideOut {
            to { opacity: 0; transform: translateX(100%); height: 0; padding: 0; margin: 0; border: 0; }
        }

        .check-anim:checked + div {
            background-color: #3b82f6;
            border-color: #3b82f6;
        }
        .check-anim:checked + div i {
            display: block;
        }
    </style>
</head>
<body class="bg-gray-100 min-h-screen font-sans text-gray-800 flex items-center justify-center py-6 px-4">

    <div class="w-full max-w-2xl bg-white rounded-2xl shadow-2xl overflow-hidden border border-gray-100">
        <!-- Header Section -->
        <div class="bg-gradient-to-br from-blue-600 to-indigo-700 p-8 text-white relative overflow-hidden">
            <div class="absolute top-0 right-0 -mr-10 -mt-10 w-40 h-40 bg-white opacity-10 rounded-full blur-2xl"></div>
            <div class="absolute bottom-0 left-0 -ml-10 -mb-10 w-32 h-32 bg-purple-500 opacity-20 rounded-full blur-2xl"></div>
            
            <div class="relative z-10">
                <h1 class="text-3xl font-bold mb-1 tracking-wide">我的待办</h1>
                <div class="flex justify-between items-end mt-4">
                    <div>
                        <p class="text-blue-100 text-sm font-medium uppercase tracking-wider" id="current-date">DATE</p>
                        <p class="text-xs text-blue-200 mt-1 opacity-80" id="greeting">Welcome back</p>
                    </div>
                    <div class="text-right">
                        <div class="text-3xl font-bold leading-none"><span id="completed-count">0</span><span class="text-lg text-blue-300 font-normal mx-1">/</span><span id="total-count" class="text-lg text-blue-200 font-normal">0</span></div>
                        <div class="text-xs text-blue-200 mt-1">Tasks Completed</div>
                    </div>
                </div>
                
                <!-- Progress Bar -->
                <div class="w-full bg-black bg-opacity-20 h-1.5 mt-6 rounded-full overflow-hidden backdrop-blur-sm">
                    <div id="progress-bar" class="bg-white h-full transition-all duration-700 ease-out w-0 shadow-[0_0_10px_rgba(255,255,255,0.5)]"></div>
                </div>
            </div>
        </div>

        <!-- Input Section -->
        <div class="p-6 bg-white border-b border-gray-100 shadow-[0_4px_20px_-10px_rgba(0,0,0,0.05)] z-20 relative">
            <div class="relative group">
                <input type="text" id="todo-input" placeholder="添加一个新的任务..." 
                    class="w-full pl-5 pr-16 py-4 rounded-xl bg-gray-50 border border-gray-200 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent focus:bg-white transition-all text-gray-700 placeholder-gray-400 shadow-inner text-lg">
                <button id="add-btn" class="absolute right-2 top-2 bottom-2 bg-blue-600 hover:bg-blue-700 active:bg-blue-800 text-white px-5 rounded-lg transition-all duration-200 shadow-lg hover:shadow-blue-500/30 flex items-center justify-center transform active:scale-95">
                    <i class="fas fa-plus text-lg"></i>
                </button>
            </div>
        </div>

        <!-- Filters -->
        <div class="flex items-center justify-center gap-1 p-3 bg-gray-50/50 border-b border-gray-100">
            <button class="filter-btn active px-5 py-1.5 rounded-full text-sm font-semibold transition-all duration-200 text-gray-500 hover:text-blue-600" data-filter="all">全部</button>
            <button class="filter-btn px-5 py-1.5 rounded-full text-sm font-semibold transition-all duration-200 text-gray-500 hover:text-blue-600" data-filter="active">进行中</button>
            <button class="filter-btn px-5 py-1.5 rounded-full text-sm font-semibold transition-all duration-200 text-gray-500 hover:text-blue-600" data-filter="completed">已完成</button>
        </div>

        <!-- Todo List -->
        <div class="bg-white min-h-[300px]">
            <ul id="todo-list" class="divide-y divide-gray-50 max-h-[500px] overflow-y-auto custom-scrollbar">
                <!-- Items will be injected here -->
            </ul>
            
            <!-- Empty State -->
            <div id="empty-state" class="hidden flex flex-col items-center justify-center py-16 text-center animate-pulse">
                <div class="bg-blue-50 p-6 rounded-full mb-4">
                    <i class="fas fa-clipboard-check text-4xl text-blue-300"></i>
                </div>
                <h3 class="text-gray-500 font-medium text-lg">暂无相关任务</h3>
                <p class="text-gray-400 text-sm mt-1">添加一个任务开始新的一天吧！</p>
            </div>
        </div>
        
        <!-- Footer -->
        <div class="p-3 bg-gray-50 text-center text-xs text-gray-400 border-t border-gray-100 flex justify-between px-6">
            <span id="clear-completed" class="cursor-pointer hover:text-red-500 transition-colors hidden">清除已完成</span>
            <span>Simple Todo List</span>
        </div>

    </div>

    <!-- Edit Modal -->
    <div id="edit-modal" class="fixed inset-0 bg-black bg-opacity-50 hidden flex items-center justify-center z-50 backdrop-blur-sm opacity-0 transition-opacity duration-300">
        <div class="bg-white rounded-xl p-6 w-full max-w-md mx-4 shadow-2xl transform scale-95 transition-transform duration-300">
            <h2 class="text-xl font-bold mb-4 text-gray-800">编辑任务</h2>
            <input type="text" id="edit-input" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:outline-none mb-4 text-lg">
            <div class="flex justify-end gap-3">
                <button id="cancel-edit" class="px-4 py-2 text-gray-600 hover:bg-gray-100 rounded-lg transition-colors">取消</button>
                <button id="save-edit" class="px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors shadow-lg hover:shadow-blue-500/30">保存</button>
            </div>
        </div>
    </div>

    <script>
        // State
        let todos = JSON.parse(localStorage.getItem('todos')) || [];
        let currentFilter = 'all';
        let editingId = null;

        // DOM Elements
        const todoInput = document.getElementById('todo-input');
        const addBtn = document.getElementById('add-btn');
        const todoList = document.getElementById('todo-list');
        const emptyState = document.getElementById('empty-state');
        const totalCountSpan = document.getElementById('total-count');
        const completedCountSpan = document.getElementById('completed-count');
        const progressBar = document.getElementById('progress-bar');
        const filterBtns = document.querySelectorAll('.filter-btn');
        const clearCompletedBtn = document.getElementById('clear-completed');
        const dateDisplay = document.getElementById('current-date');
        const greetingDisplay = document.getElementById('greeting');
        
        // Modal Elements
        const editModal = document.getElementById('edit-modal');
        const editInput = document.getElementById('edit-input');
        const cancelEditBtn = document.getElementById('cancel-edit');
        const saveEditBtn = document.getElementById('save-edit');

        // Initialization
        function init() {
            render();
            updateDate();
            setGreeting();
        }

        function updateDate() {
            const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
            const today = new Date();
            dateDisplay.textContent = today.toLocaleDateString('zh-CN', options);
        }

        function setGreeting() {
            const hour = new Date().getHours();
            let greeting = 'Good Morning';
            if (hour >= 12 && hour < 18) greeting = 'Good Afternoon';
            else if (hour >= 18) greeting = 'Good Evening';
            greetingDisplay.textContent = `${greeting}, 准备好完成任务了吗？`;
        }

        // Core Functions
        function save() {
            localStorage.setItem('todos', JSON.stringify(todos));
            render();
        }

        function addTodo() {
            const text = todoInput.value.trim();
            if (!text) return;

            const newTodo = {
                id: Date.now(),
                text: text,
                completed: false,
                createdAt: new Date().toISOString()
            };

            todos.unshift(newTodo);
            todoInput.value = '';
            save();
        }

        function toggleTodo(id) {
            todos = todos.map(t => t.id === id ? { ...t, completed: !t.completed } : t);
            save();
        }

        function deleteTodo(id) {
            // Find the element to animate it out first
            const el = document.getElementById(`todo-${id}`);
            if (el) {
                el.classList.add('slide-out');
                setTimeout(() => {
                    todos = todos.filter(t => t.id !== id);
                    save();
                }, 300);
            } else {
                todos = todos.filter(t => t.id !== id);
                save();
            }
        }

        function openEditModal(id) {
            const todo = todos.find(t => t.id === id);
            if (!todo) return;
            
            editingId = id;
            editInput.value = todo.text;
            
            editModal.classList.remove('hidden');
            // Trigger reflow for transition
            void editModal.offsetWidth; 
            editModal.classList.remove('opacity-0');
            editModal.querySelector('div').classList.remove('scale-95');
            editModal.querySelector('div').classList.add('scale-100');
            
            setTimeout(() => editInput.focus(), 100);
        }

        function closeEditModal() {
            editModal.classList.add('opacity-0');
            editModal.querySelector('div').classList.add('scale-95');
            editModal.querySelector('div').classList.remove('scale-100');
            
            setTimeout(() => {
                editModal.classList.add('hidden');
                editingId = null;
            }, 300);
        }

        function saveEdit() {
            const text = editInput.value.trim();
            if (!text) return;

            todos = todos.map(t => t.id === editingId ? { ...t, text: text } : t);
            save();
            closeEditModal();
        }

        function clearCompleted() {
            todos = todos.filter(t => !t.completed);
            save();
        }

        // Render Logic
        function render() {
            // Filter
            let filteredTodos = todos;
            if (currentFilter === 'active') filteredTodos = todos.filter(t => !t.completed);
            if (currentFilter === 'completed') filteredTodos = todos.filter(t => t.completed);

            // Stats
            const total = todos.length;
            const completed = todos.filter(t => t.completed).length;
            totalCountSpan.textContent = total;
            completedCountSpan.textContent = completed;
            
            // Progress Bar
            const percentage = total === 0 ? 0 : (completed / total) * 100;
            progressBar.style.width = `${percentage}%`;
            
            // Clear Completed Button visibility
            if (completed > 0) {
                clearCompletedBtn.classList.remove('hidden');
            } else {
                clearCompletedBtn.classList.add('hidden');
            }

            // Empty State
            if (filteredTodos.length === 0) {
                todoList.innerHTML = '';
                emptyState.classList.remove('hidden');
                emptyState.classList.add('flex');
            } else {
                emptyState.classList.add('hidden');
                emptyState.classList.remove('flex');
                
                todoList.innerHTML = filteredTodos.map(todo => `
                    <li id="todo-${todo.id}" class="fade-in group flex items-center p-4 hover:bg-gray-50 transition-colors duration-200 border-l-4 ${todo.completed ? 'border-green-500 bg-gray-50/50' : 'border-transparent'}">
                        <label class="relative flex items-center cursor-pointer p-2">
                            <input type="checkbox" class="check-anim peer sr-only" ${todo.completed ? 'checked' : ''} onchange="toggleTodo(${todo.id})">
                            <div class="w-6 h-6 border-2 border-gray-300 rounded-full peer-checked:bg-blue-500 peer-checked:border-blue-500 transition-all duration-200 flex items-center justify-center">
                                <i class="fas fa-check text-white text-xs hidden"></i>
                            </div>
                        </label>
                        
                        <div class="flex-1 ml-3 cursor-pointer" ondblclick="openEditModal(${todo.id})">
                            <span class="text-lg ${todo.completed ? 'line-through text-gray-400' : 'text-gray-700'} transition-all duration-200 break-all">${escapeHtml(todo.text)}</span>
                            <div class="text-xs text-gray-400 mt-0.5">
                                ${new Date(todo.createdAt).toLocaleTimeString('zh-CN', {hour: '2-digit', minute:'2-digit'})}
                            </div>
                        </div>

                        <div class="flex items-center gap-2 opacity-0 group-hover:opacity-100 transition-opacity duration-200">
                            <button onclick="openEditModal(${todo.id})" class="p-2 text-gray-400 hover:text-blue-600 hover:bg-blue-50 rounded-lg transition-colors" title="编辑">
                                <i class="fas fa-pen"></i>
                            </button>
                            <button onclick="deleteTodo(${todo.id})" class="p-2 text-gray-400 hover:text-red-600 hover:bg-red-50 rounded-lg transition-colors" title="删除">
                                <i class="fas fa-trash-alt"></i>
                            </button>
                        </div>
                    </li>
                `).join('');
            }
        }

        // Helper to prevent XSS
        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        // Event Listeners
        addBtn.addEventListener('click', addTodo);
        
        todoInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') addTodo();
        });

        filterBtns.forEach(btn => {
            btn.addEventListener('click', () => {
                // Update active class style
                filterBtns.forEach(b => {
                    b.classList.remove('bg-white', 'shadow-sm', 'text-blue-600');
                    b.classList.add('text-gray-500');
                });
                btn.classList.add('bg-white', 'shadow-sm', 'text-blue-600');
                btn.classList.remove('text-gray-500');

                currentFilter = btn.dataset.filter;
                render();
            });
        });

        clearCompletedBtn.addEventListener('click', clearCompleted);
        
        // Modal Events
        cancelEditBtn.addEventListener('click', closeEditModal);
        saveEditBtn.addEventListener('click', saveEdit);
        editInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') saveEdit();
        });
        editModal.addEventListener('click', (e) => {
            if (e.target === editModal) closeEditModal();
        });

        // Initialize styles for active filter
        document.querySelector('[data-filter="all"]').classList.add('bg-white', 'shadow-sm', 'text-blue-600');
        document.querySelector('[data-filter="all"]').classList.remove('text-gray-500');

        init();
    </script>
</body>
</html>
