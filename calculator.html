<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>炫酷科学计算器</title>
<script src="https://cdn.tailwindcss.com"></script>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet">
<style>
body{font-family:Inter,system-ui,Segoe UI,Roboto}
.glass{backdrop-filter:saturate(180%) blur(14px); background:linear-gradient(135deg,rgba(17,24,39,.7),rgba(17,24,39,.55))}
.neon{box-shadow:0 0 20px rgba(59,130,246,.25), inset 0 0 20px rgba(59,130,246,.15)}
.btn{transition:all .15s ease; user-select:none}
.btn:active{transform:scale(.96)}
.grid-btn{display:grid; grid-template-columns:repeat(4,minmax(0,1fr)); gap:.6rem}
.scroll-smooth{scroll-behavior:smooth}
.ring-focus:focus{outline:none; box-shadow:0 0 0 3px rgba(59,130,246,.5)}
.glow{text-shadow:0 0 10px rgba(255,255,255,.15)}
.panel{max-width:980px}
.kpad{grid-template-columns:repeat(4,minmax(0,1fr))}
.history::-webkit-scrollbar{width:6px}
.history::-webkit-scrollbar-thumb{background:#374151; border-radius:4px}
</style>
</head>
<body class="min-h-screen bg-gradient-to-br from-[#0f172a] via-[#0b1020] to-[#111827] text-gray-100 flex items-center justify-center p-6">
<div class="w-full panel grid grid-cols-1 lg:grid-cols-[2fr_1fr] gap-6">
<div class="glass rounded-2xl border border-white/10 p-6 shadow-2xl neon">
<div class="flex items-center justify-between mb-4">
<div class="flex items-center gap-3">
<div class="w-2 h-2 rounded-full bg-green-400 animate-pulse"></div>
<div class="text-sm text-gray-300">科学计算器</div>
</div>
<div class="flex items-center gap-2">
<button id="degBtn" class="btn px-3 py-1.5 rounded-lg bg-blue-600 hover:bg-blue-700 text-white text-xs font-semibold">DEG</button>
<button id="radBtn" class="btn px-3 py-1.5 rounded-lg bg-gray-700 hover:bg-gray-600 text-white text-xs font-semibold">RAD</button>
</div>
</div>
<div class="rounded-xl bg-black/40 border border-white/10 p-4 mb-4">
<div id="expression" class="text-right text-lg text-gray-300 min-h-[28px] glow break-all"></div>
<div id="display" class="text-right text-4xl md:text-5xl font-bold tracking-wide mt-2 text-white glow break-all">0</div>
</div>
<div class="grid grid-cols-4 gap-2 mb-2">
<button class="btn px-3 py-2 rounded-lg bg-purple-600/40 hover:bg-purple-600/60 text-purple-200 font-semibold" data-action="mc">MC</button>
<button class="btn px-3 py-2 rounded-lg bg-purple-600/40 hover:bg-purple-600/60 text-purple-200 font-semibold" data-action="mr">MR</button>
<button class="btn px-3 py-2 rounded-lg bg-purple-600/40 hover:bg-purple-600/60 text-purple-200 font-semibold" data-action="mplus">M+</button>
<button class="btn px-3 py-2 rounded-lg bg-purple-600/40 hover:bg-purple-600/60 text-purple-200 font-semibold" data-action="mminus">M-</button>
</div>
<div class="grid grid-cols-4 gap-2 mb-2">
<button class="btn px-3 py-2 rounded-lg bg-red-600/70 hover:bg-red-600 text-white font-bold" data-action="ac">AC</button>
<button class="btn px-3 py-2 rounded-lg bg-red-500/60 hover:bg-red-500 text-white font-semibold" data-action="ce">CE</button>
<button class="btn px-3 py-2 rounded-lg bg-gray-700 hover:bg-gray-600 text-white font-semibold" data-action="back">⌫</button>
<button class="btn px-3 py-2 rounded-lg bg-gray-700 hover:bg-gray-600 text-white font-semibold" data-value="/">÷</button>
</div>
<div class="grid grid-cols-4 gap-2 mb-2">
<button class="btn px-3 py-2 rounded-lg bg-indigo-600/40 hover:bg-indigo-600/60 text-indigo-200 font-semibold" data-func="sin">sin</button>
<button class="btn px-3 py-2 rounded-lg bg-indigo-600/40 hover:bg-indigo-600/60 text-indigo-200 font-semibold" data-func="cos">cos</button>
<button class="btn px-3 py-2 rounded-lg bg-indigo-600/40 hover:bg-indigo-600/60 text-indigo-200 font-semibold" data-func="tan">tan</button>
<button class="btn px-3 py-2 rounded-lg bg-gray-700 hover:bg-gray-600 text-white font-semibold" data-value="*">×</button>
</div>
<div class="grid grid-cols-4 gap-2 mb-2">
<button class="btn px-3 py-2 rounded-lg bg-indigo-600/40 hover:bg-indigo-600/60 text-indigo-200 font-semibold" data-func="log">log</button>
<button class="btn px-3 py-2 rounded-lg bg-indigo-600/40 hover:bg-indigo-600/60 text-indigo-200 font-semibold" data-func="ln">ln</button>
<button class="btn px-3 py-2 rounded-lg bg-indigo-600/40 hover:bg-indigo-600/60 text-indigo-200 font-semibold" data-func="sqrt">√</button>
<button class="btn px-3 py-2 rounded-lg bg-gray-700 hover:bg-gray-600 text-white font-semibold" data-value="-">−</button>
</div>
<div class="grid grid-cols-4 gap-2 mb-2">
<button class="btn px-3 py-2 rounded-lg bg-indigo-600/40 hover:bg-indigo-600/60 text-indigo-200 font-semibold" data-action="square">x²</button>
<button class="btn px-3 py-2 rounded-lg bg-indigo-600/40 hover:bg-indigo-600/60 text-indigo-200 font-semibold" data-action="cube">x³</button>
<button class="btn px-3 py-2 rounded-lg bg-indigo-600/40 hover:bg-indigo-600/60 text-indigo-200 font-semibold" data-value="^">^</button>
<button class="btn px-3 py-2 rounded-lg bg-gray-700 hover:bg-gray-600 text-white font-semibold" data-value="+">+</button>
</div>
<div class="grid grid-cols-4 gap-2 mb-2">
<button class="btn px-3 py-2 rounded-lg bg-gray-700 hover:bg-gray-600 text-white font-semibold" data-value="(">(</button>
<button class="btn px-3 py-2 rounded-lg bg-gray-700 hover:bg-gray-600 text-white font-semibold" data-value=")">)</button>
<button class="btn px-3 py-2 rounded-lg bg-indigo-600/40 hover:bg-indigo-600/60 text-indigo-200 font-semibold" data-value="!">!</button>
<button class="btn px-3 py-2 rounded-lg bg-indigo-600/40 hover:bg-indigo-600/60 text-indigo-200 font-semibold" data-action="recip">1/x</button>
</div>
<div class="grid grid-cols-4 gap-2 mb-2">
<button class="btn px-3 py-2 rounded-lg bg-indigo-600/40 hover:bg-indigo-600/60 text-indigo-200 font-semibold" data-const="pi">π</button>
<button class="btn px-3 py-2 rounded-lg bg-indigo-600/40 hover:bg-indigo-600/60 text-indigo-200 font-semibold" data-const="e">e</button>
<button class="btn px-3 py-2 rounded-lg bg-indigo-600/40 hover:bg-indigo-600/60 text-indigo-200 font-semibold" data-value="%">%</button>
<button class="btn px-3 py-2 rounded-lg bg-gray-700 hover:bg-gray-600 text-white font-semibold" data-action="sign">±</button>
</div>
<div class="grid grid-cols-4 gap-2">
<button class="btn px-3 py-3 rounded-lg bg-gray-800 hover:bg-gray-700 text-white font-semibold" data-value="7">7</button>
<button class="btn px-3 py-3 rounded-lg bg-gray-800 hover:bg-gray-700 text-white font-semibold" data-value="8">8</button>
<button class="btn px-3 py-3 rounded-lg bg-gray-800 hover:bg-gray-700 text-white font-semibold" data-value="9">9</button>
<button class="btn row-span-2 px-3 py-3 rounded-lg bg-blue-600 hover:bg-blue-700 text-white font-bold" data-action="equals">=</button>
<button class="btn px-3 py-3 rounded-lg bg-gray-800 hover:bg-gray-700 text-white font-semibold" data-value="4">4</button>
<button class="btn px-3 py-3 rounded-lg bg-gray-800 hover:bg-gray-700 text-white font-semibold" data-value="5">5</button>
<button class="btn px-3 py-3 rounded-lg bg-gray-800 hover:bg-gray-700 text-white font-semibold" data-value="6">6</button>
<button class="btn px-3 py-3 rounded-lg bg-gray-800 hover:bg-gray-700 text-white font-semibold" data-value="1">1</button>
<button class="btn px-3 py-3 rounded-lg bg-gray-800 hover:bg-gray-700 text-white font-semibold" data-value="2">2</button>
<button class="btn px-3 py-3 rounded-lg bg-gray-800 hover:bg-gray-700 text-white font-semibold" data-value="3">3</button>
<button class="btn px-3 py-3 rounded-lg bg-gray-800 hover:bg-gray-700 text-white font-semibold" data-value="0">0</button>
<button class="btn px-3 py-3 rounded-lg bg-gray-800 hover:bg-gray-700 text-white font-semibold" data-value=".">.</button>
</div>
</div>
<div class="glass rounded-2xl border border-white/10 p-6 shadow-2xl neon">
<div class="text-sm text-gray-300 mb-3">历史记录</div>
<div id="history" class="history space-y-2 max-h-[520px] overflow-y-auto">
</div>
</div>
</div>
<script>
let expr="";
let memory=0;
let isDeg=true;
let history=[];
const display=document.getElementById("display");
const expression=document.getElementById("expression");
const historyEl=document.getElementById("history");
const degBtn=document.getElementById("degBtn");
const radBtn=document.getElementById("radBtn");
function updateDisplay(){expression.textContent=expr; if(expr.trim()===""){display.textContent="0"}}
function pushHistory(e,r){history.unshift({e,r}); if(history.length>20)history.pop(); renderHistory()}
function renderHistory(){historyEl.innerHTML=history.map((h,i)=>`<div class="flex items-center justify-between rounded-lg bg-black/40 border border-white/10 p-3">
<div class="text-xs text-gray-400">${i+1}</div>
<div class="flex-1 px-3"><div class="text-sm text-gray-300 break-all">${escapeHtml(h.e)}</div><div class="text-lg font-semibold text-white">${h.r}</div></div>
<button class="btn px-3 py-1 rounded-md bg-blue-600/50 hover:bg-blue-600 text-white text-xs font-semibold" data-load="${escapeAttr(h.e)}">载入</button>
</div>`).join(""); Array.from(historyEl.querySelectorAll("[data-load]")).forEach(b=>b.addEventListener("click",()=>{expr=b.getAttribute("data-load"); updateDisplay()}))}
function escapeHtml(t){const d=document.createElement("div"); d.textContent=t; return d.innerHTML}
function escapeAttr(t){return t.replace(/"/g,"&quot;")}
function insert(v){expr+=v; updateDisplay()}
function ac(){expr=""; updateDisplay()}
function ce(){expr=expr.slice(0,-1); updateDisplay()}
function back(){expr=expr.slice(0,-1); updateDisplay()}
function sign(){const m=expr.match(/(-?\d*\.?\d+)(?!.*\d)/); if(!m){expr=expr?expr+"*(-1)":"-"; updateDisplay(); return} const n=m[1]; const idx=expr.lastIndexOf(n); const rep=n.startsWith("-")?n.slice(1):"-"+n; expr=expr.slice(0,idx)+rep+expr.slice(idx+n.length); updateDisplay()}
function square(){expr=expr?expr+"^2":"0^2"; updateDisplay()}
function cube(){expr=expr?expr+"^3":"0^3"; updateDisplay()}
function recip(){const m=expr.match(/([\d\.]+|\([^\)]+\))$/); if(!m){expr="1/("+expr+")"; updateDisplay(); return} const t=m[1]; const idx=expr.lastIndexOf(t); expr=expr.slice(0,idx)+"1/("+t+")"+expr.slice(idx+t.length); updateDisplay()}
function insertFunc(f){if(f==="sqrt"){expr+="sqrt("; updateDisplay(); return} expr+=f+"("; updateDisplay()}
function insertConst(c){if(c==="pi"){expr+="π"} else {expr+="e"} updateDisplay()}
function sanitizePercent(s){let r=s; const pct=/([\d\.]+|\([^\)]+\))%/; let i=0; while(pct.test(r)&&i<50){r=r.replace(pct,"($1/100)"); i++} return r}
function sanitizeFact(s){let r=s; const f=/([\d\.]+|\([^\)]+\))!/; let i=0; while(f.test(r)&&i<50){r=r.replace(f,"FACT($1)"); i++} return r}
function toSafe(s){let r=s.replace(/×/g,"*").replace(/÷/g,"/"); r=r.replace(/\^/g,"**"); r=sanitizePercent(r); r=sanitizeFact(r); r=r.replace(/π/g,"Math.PI").replace(/(?<![A-Za-z])e(?![A-Za-z])/g,"Math.E"); r=r.replace(/sqrt\(/g,"Math.sqrt("); r=r.replace(/log\(/g,"LOG(").replace(/ln\(/g,"LN("); r=r.replace(/sin\(/g,"SIN(").replace(/cos\(/g,"COS(").replace(/tan\(/g,"TAN("); r=r.replace(/asin\(/g,"ASIN(").replace(/acos\(/g,"ACOS(").replace(/atan\(/g,"ATAN("); return r}
function allowed(s){return /^[0-9+\-*/^%().,! \sA-Za-z_.]+$/.test(s)}
function FACT(n){if(!isFinite(n))return NaN; if(n<0)return NaN; let r=1; for(let i=2;i<=Math.floor(n);i++)r*=i; return r}
function LOG(x){return Math.log10(x)}
function LN(x){return Math.log(x)}
function toRad(x){return x*Math.PI/180}
function fromRad(x){return x*180/Math.PI}
function SIN(x){return isDeg?Math.sin(toRad(x)):Math.sin(x)}
function COS(x){return isDeg?Math.cos(toRad(x)):Math.cos(x)}
function TAN(x){return isDeg?Math.tan(toRad(x)):Math.tan(x)}
function ASIN(x){return isDeg?fromRad(Math.asin(x)):Math.asin(x)}
function ACOS(x){return isDeg?fromRad(Math.acos(x)):Math.acos(x)}
function ATAN(x){return isDeg?fromRad(Math.atan(x)):Math.atan(x)}
function evaluate(){const safe=toSafe(expr); if(!allowed(safe)){display.textContent="错误"; return} try{const result=Function('"use strict"; return ('+safe+')')(); const out=(typeof result==="number"&&isFinite(result))?formatNum(result):"错误"; display.textContent=out; pushHistory(expr,out)}catch(_){display.textContent="错误"}}
function formatNum(n){const a=Math.abs(n); if(a!==0&& (a<1e-6 || a>=1e9)) return n.toExponential(8); return String(Math.round(n*1e12)/1e12)}
degBtn.addEventListener("click",()=>{isDeg=true; degBtn.classList.replace("bg-gray-700","bg-blue-600"); radBtn.classList.replace("bg-blue-600","bg-gray-700")});
radBtn.addEventListener("click",()=>{isDeg=false; radBtn.classList.replace("bg-gray-700","bg-blue-600"); degBtn.classList.replace("bg-blue-600","bg-gray-700")});
document.querySelectorAll("[data-value]").forEach(b=>b.addEventListener("click",()=>insert(b.getAttribute("data-value"))));
document.querySelectorAll("[data-func]").forEach(b=>b.addEventListener("click",()=>insertFunc(b.getAttribute("data-func"))));
document.querySelectorAll("[data-const]").forEach(b=>b.addEventListener("click",()=>insertConst(b.getAttribute("data-const"))));
document.querySelector("[button][data-action]");
document.querySelectorAll("[data-action]").forEach(b=>b.addEventListener("click",()=>{
const a=b.getAttribute("data-action");
if(a==="ac")ac();
else if(a==="ce")ce();
else if(a==="back")back();
else if(a==="equals")evaluate();
else if(a==="square")square();
else if(a==="cube")cube();
else if(a==="recip")recip();
else if(a==="sign")sign();
else if(a==="mc"){memory=0}
else if(a==="mr"){expr+=formatNum(memory); updateDisplay()}
else if(a==="mplus"){const safe=toSafe(expr||"0"); if(allowed(safe)){try{memory+=Number(Function('"use strict"; return ('+safe+')')())}catch(_){}}}
else if(a==="mminus"){const safe=toSafe(expr||"0"); if(allowed(safe)){try{memory-=Number(Function('"use strict"; return ('+safe+')')())}catch(_){}}}
}));
document.addEventListener("keydown",e=>{
const k=e.key;
if(/[0-9]/.test(k)) insert(k);
else if(k==="+"||k==="-"||k==="*"||k==="/"||k==="."||k==="("||k===")"||k==="^") insert(k);
else if(k==="Enter"||k==="="){e.preventDefault(); evaluate()}
else if(k==="Backspace"){back()}
else if(k==="Delete"){ce()}
});
updateDisplay();
</script>
</body>
</html>
